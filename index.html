<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Management App</title>

  <!-- Styling -->
  <style>
    :root {
      --bg: #f0f4ff;
      --card: #ffffff;
      --accent: #4f46e5;
      --muted: #6b7280;
      --danger: #ef4444;
      --success: #10b981;
      font-family: 'Inter', sans-serif;
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, var(--bg), #eef2ff 120%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 16px;
      color: #0f172a;
    }

    .container {
      width: 100%;
      max-width: 950px;
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      padding: 32px;
      box-sizing: border-box;
      transition: transform 0.2s ease;
    }

    .container:hover {
      transform: translateY(-4px);
    }

    h1 {
      margin: 0 0 12px 0;
      font-size: 28px;
      font-weight: 700;
      color: var(--accent);
    }

    p.lead {
      margin: 0 0 24px 0;
      color: var(--muted);
      font-size: 15px;
    }

    /* Form */
    .form-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    input[type="text"] {
      flex: 1 1 320px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #e0e7ff;
      font-size: 15px;
      outline: none;
      transition: box-shadow 0.2s ease, border-color 0.2s ease;
    }

    input[type="text"]:focus {
      box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.12);
      border-color: var(--accent);
    }

    button {
      padding: 12px 16px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: white;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background 0.2s ease, transform 0.1s ease;
    }

    button:hover {
      background: #3730a3;
      transform: translateY(-1px);
    }

    button.secondary {
      background: #f3f4f6;
      color: #111827;
      border: 1px solid #e5e7eb;
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      background: #f9fafb;
      border-radius: 12px;
      overflow: hidden;
    }

    thead {
      background: #eef2ff;
    }

    thead th {
      text-align: left;
      font-size: 14px;
      padding: 14px 16px;
      color: var(--muted);
    }

    tbody td {
      padding: 14px 16px;
      vertical-align: middle;
      font-size: 14px;
      border-bottom: 1px solid #e5e7eb;
    }

    tbody tr:hover {
      background: #f3f4f6;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .btn-edit {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #c7d2fe;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
      color: #4f46e5;
      transition: background 0.2s ease;
    }

    .btn-edit:hover {
      background: #eef2ff;
    }

    .btn-delete {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(239, 68, 68, 0.3);
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s ease;
    }

    .btn-delete:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    .empty {
      text-align: center;
      color: var(--muted);
      padding: 24px 0;
      font-size: 15px;
      font-style: italic;
    }

    .status {
      font-size: 13px;
      color: var(--muted);
      margin-left: 8px;
    }

    @media (max-width: 520px) {
      .form-row {
        flex-direction: column;
        align-items: stretch;
      }
      button {
        width: 100%;
      }
      .actions {
        flex-direction: column;
      }
      .actions button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>Product Management App</h1>
    <p class="lead">Add, edit and remove products stored in a Supabase table called <code>products</code>.</p>

    <!-- Form -->
    <div class="form-row" aria-label="Add product form">
      <input id="productName" type="text" placeholder="Enter product name" aria-label="Product name" />
      <button id="addBtn">Add Product</button>
      <span id="status" class="status" aria-live="polite"></span>
    </div>

    <!-- Table -->
    <div id="tableWrap">
      <table id="productsTable" aria-label="Products table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="productsBody">
        </tbody>
      </table>
      <div id="empty" class="empty" style="display:none;">No products found. Add one above.</div>
    </div>
  </div>

  <!-- Supabase JS -->
 <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
  const supabaseUrl = 'https://czciscticjqngokdgrdn.supabase.co';
  const supabaseKey = 'sb_publishable_HcQFkjx-bijcsuH-5FSX5A_--p2pq9j';
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
    const productNameInput = document.getElementById('productName');
    const addBtn = document.getElementById('addBtn');
    const productsBody = document.getElementById('productsBody');
    const emptyDiv = document.getElementById('empty');
    const statusSpan = document.getElementById('status');

    function setStatus(msg, timeout = 3500) {
      statusSpan.textContent = msg || '';
      if (!msg) return;
      clearTimeout(setStatus._t);
      setStatus._t = setTimeout(() => statusSpan.textContent = '', timeout);
    }

    async function fetchProducts() {
      setStatus('Loading products...');
      try {
        const { data, error } = await supabaseClient
          .from('products')
          .select('id, name')
          .order('id', { ascending: true });
        if (error) throw error;
        renderProducts(data || []);
        setStatus('Products loaded.');
      } catch (err) {
        console.error(err);
        setStatus('Failed to load products.');
      }
    }

    function renderProducts(products) {
      productsBody.innerHTML = '';
      if (!products.length) {
        emptyDiv.style.display = 'block';
        return;
      }
      emptyDiv.style.display = 'none';

      products.forEach(p => {
        const tr = document.createElement('tr');
        const tdName = document.createElement('td');
        tdName.textContent = p.name;
        tdName.setAttribute('data-id', p.id);

        const tdActions = document.createElement('td');
        const actions = document.createElement('div');
        actions.className = 'actions';

        const editBtn = document.createElement('button');
        editBtn.className = 'btn-edit';
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', () => onEditProduct(p.id, p.name, tdName));

        const delBtn = document.createElement('button');
        delBtn.className = 'btn-delete';
        delBtn.textContent = 'Delete';
        delBtn.addEventListener('click', () => onDeleteProduct(p.id, tr));

        actions.append(editBtn, delBtn);
        tdActions.appendChild(actions);

        tr.append(tdName, tdActions);
        productsBody.appendChild(tr);
      });
    }

    async function onAddProduct() {
      const name = productNameInput.value.trim();
      if (!name) { setStatus('Enter a product name'); return; }
      addBtn.disabled = true;
      addBtn.textContent = 'Adding...';
      try {
        const { error } = await supabaseClient.from('products').insert([{ name }]);
        if (error) throw error;
        productNameInput.value = '';
        await fetchProducts();
        setStatus('Product added', 2500);
      } catch (err) {
        console.error(err);
        setStatus('Failed to add product');
      } finally {
        addBtn.disabled = false;
        addBtn.textContent = 'Add Product';
      }
    }

    async function onEditProduct(id, currentName, nameCell) {
      const newName = prompt('Update product name:', currentName);
      if (!newName) return;
      const trimmed = newName.trim();
      if (!trimmed) { alert('Name cannot be empty'); return; }
      const oldText = nameCell.textContent;
      nameCell.textContent = trimmed;
      setStatus('Updating...');
      try {
        const { error } = await supabaseClient.from('products').update({ name: trimmed }).eq('id', id);
        if (error) throw error;
        setStatus('Updated', 2000);
      } catch (err) {
        console.error(err);
        nameCell.textContent = oldText;
        setStatus('Failed to update');
      }
    }

    async function onDeleteProduct(id, row) {
      if (!confirm('Delete this product?')) return;
      setStatus('Deleting...');
      try {
        const { error } = await supabaseClient.from('products').delete().eq('id', id);
        if (error) throw error;
        row.remove();
        if (!productsBody.children.length) emptyDiv.style.display = 'block';
        setStatus('Deleted', 2000);
      } catch (err) {
        console.error(err);
        setStatus('Failed to delete');
      }
    }

    addBtn.addEventListener('click', onAddProduct);
    productNameInput.addEventListener('keydown', e => { if(e.key==='Enter') onAddProduct(); });
    fetchProducts();
  </script>
</body>
</html>

